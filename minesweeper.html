<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yen Teng | Minesweeper</title>

  <style>
    :root{
      --bg: #0f1117;
      --surface: #151a23;
      --ink: #f3f4f6;
      --muted: #b0b7c3;
      --border: #2a3242;
      --accent: #7aa88a;
      --shadow: 0 12px 30px rgba(0, 0, 0, 0.55);
      --radius: 18px;

      --cell: rgba(255,255,255,0.06);
      --cellHover: rgba(255,255,255,0.10);
      --cellRevealed: rgba(255,255,255,0.02);
      --cellClear: rgba(122,168,138,0.10);
    }

    *{ box-sizing: border-box; }
    body{
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background:
        radial-gradient(900px 500px at 20% 10%, rgba(122,168,138,0.14), transparent 55%),
        radial-gradient(900px 500px at 80% 0%, rgba(122,168,138,0.10), transparent 60%),
        var(--bg);
      color: var(--ink);
      line-height: 1.6;
      min-height: 100vh;
    }

    a { color: inherit; text-decoration: none; }
    a:hover { text-decoration: underline; }

    .container{
      max-width: 980px;
      margin: 0 auto;
      padding: 24px;
    }

    .nav{
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 0 24px;
      gap: 12px;
    }
    .brand{ font-weight: 700; }
    .navlinks{
      display: flex;
      gap: 12px;
      font-size: 14px;
      color: var(--muted);
      align-items: center;
    }
    .navlinks a{
      padding: 8px 10px;
      border-radius: 999px;
    }
    .navlinks a:hover{
      background: rgba(255,255,255,0.06);
      text-decoration: none;
      color: var(--ink);
    }

    .card{
      background: rgba(21, 26, 35, 0.85);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(6px);
    }

    .titleRow{
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }
    h1{
      margin: 0;
      font-size: 28px;
      letter-spacing: -0.3px;
    }
    .sub{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 14px;
      max-width: 70ch;
    }

    .controls{
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
      align-items: center;
    }

    .pill{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.04);
      padding: 8px 10px;
      border-radius: 999px;
      color: var(--muted);
      font-size: 13px;
      display: inline-flex;
      gap: 8px;
      align-items: center;
    }

    button{
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color: var(--ink);
      padding: 10px 12px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
    }
    button:hover{ background: rgba(255,255,255,0.10); }
    button:active{ transform: translateY(1px); }

    /* ---------- Custom dropdown (always dark) ---------- */
    .dd{
      position: relative;
      display: inline-block;
    }
    .ddBtn{
      display: inline-flex;
      align-items: center;
      gap: 10px;
      white-space: nowrap;
    }
    .caret{
      opacity: 0.9;
      font-weight: 900;
    }
    .ddMenu{
      position: absolute;
      top: calc(100% + 8px);
      left: 0;
      min-width: 260px;
      background: #0b0d12;
      border: 1px solid var(--border);
      border-radius: 14px;
      box-shadow: 0 18px 40px rgba(0,0,0,0.6);
      padding: 8px;
      display: none;
      z-index: 20;
    }
    .dd.open .ddMenu{ display: block; }
    .ddItem{
      width: 100%;
      text-align: left;
      background: transparent;
      border: 1px solid transparent;
      padding: 10px 10px;
      border-radius: 12px;
      color: var(--ink);
      cursor: pointer;
      font-weight: 700;
      font-size: 14px;
    }
    .ddItem span{
      display: block;
      color: var(--muted);
      font-weight: 600;
      font-size: 12px;
      margin-top: 2px;
    }
    .ddItem:hover{
      background: rgba(255,255,255,0.06);
      border-color: rgba(255,255,255,0.08);
    }
    .ddItem.active{
      background: rgba(122,168,138,0.14);
      border-color: rgba(122,168,138,0.28);
    }

    .gridWrap{
      margin-top: 16px;
      display: grid;
      place-items: center;
    }

    .board{
      display: grid;
      gap: 8px;
      padding: 12px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: rgba(255,255,255,0.03);
      overflow: auto;
      max-width: 100%;
    }

    .cell{
      width: 34px;
      height: 34px;
      border-radius: 10px;
      border: 1px solid var(--border);
      background: var(--cell);
      display: grid;
      place-items: center;
      font-weight: 800;
      user-select: none;
      cursor: pointer;
      transition: background 120ms ease, transform 120ms ease, border-color 120ms ease;
    }
    .cell:hover{ background: var(--cellHover); }
    .cell:active{ transform: translateY(1px); }

    .cell.revealed{
      cursor: default;
      background: var(--cellRevealed);
      border-color: rgba(255,255,255,0.08);
    }
    .cell.revealed.clear{
      background: var(--cellClear);
      border-color: rgba(122,168,138,0.35);
    }
    .cell.flagged{
      background: rgba(122,168,138,0.14);
    }
    .cell.bomb.revealed{
      background: rgba(255, 107, 107, 0.14);
      border-color: rgba(255, 107, 107, 0.35);
    }

    .legend{
      margin-top: 12px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }
    .kbd{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      border: 1px solid var(--border);
      padding: 2px 7px;
      border-radius: 7px;
      background: rgba(255,255,255,0.04);
      color: var(--ink);
      font-size: 12px;
    }

    .n1{ color: #8ab4f8; }
    .n2{ color: #7ee787; }
    .n3{ color: #ff7b72; }
    .n4{ color: #d2a8ff; }
    .n5{ color: #ffa657; }
    .n6{ color: #79c0ff; }
    .n7{ color: #c9d1d9; }
    .n8{ color: #e3b341; }

    footer{
      text-align: center;
      color: var(--muted);
      font-size: 13px;
      padding: 18px 0 8px;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="nav">
      <div class="brand">Yen Teng</div>
      <div class="navlinks">
        <a href="./index.html">Back to site</a>
      </div>
    </div>

    <section class="card">
      <div class="titleRow">
        <div>
          <h1>Minesweeper</h1>
          <p class="sub">
            Left click to reveal. Right click (or long-press on mobile) to flag.
            First click is always safe.
          </p>
        </div>

        <div class="controls">
          <span class="pill">‚è±Ô∏è Time: <strong id="time">0</strong>s</span>
          <span class="pill">üí£ Mines: <strong id="minesLeft">0</strong></span>
          <span class="pill">Status: <strong id="status">Ready</strong></span>
        </div>
      </div>

      <div class="controls" style="margin-top: 10px;">
        <span class="pill" style="gap:10px;">
          Difficulty
          <div class="dd" id="dd">
            <button class="ddBtn" id="ddBtn" type="button">
              <span id="ddLabel">Easy (8√ó8)</span> <span class="caret">‚ñæ</span>
            </button>
            <div class="ddMenu" id="ddMenu" role="menu" aria-label="Difficulty menu">
              <button class="ddItem active" type="button" data-value="easy">
                Easy (8√ó8) <span>10 mines</span>
              </button>
              <button class="ddItem" type="button" data-value="medium">
                Medium (12√ó12) <span>25 mines</span>
              </button>
              <button class="ddItem" type="button" data-value="hard">
                Hard (16√ó16) <span>40 mines</span>
              </button>
            </div>
          </div>
        </span>

        <button id="newGame" type="button">New Game</button>
      </div>

      <div class="gridWrap">
        <div id="board" class="board" aria-label="Minesweeper board"></div>
      </div>

      <div class="legend">
        Controls: <span class="kbd">Left Click</span> reveal ‚Ä¢
        <span class="kbd">Right Click</span> flag ‚Ä¢
        Mobile: <span class="kbd">Tap</span> reveal ‚Ä¢
        <span class="kbd">Long press</span> flag
      </div>
    </section>

    <footer>
      ¬© <span id="year"></span> Yen Teng
    </footer>
  </div>

  <script>
    const $ = (id) => document.getElementById(id);

    const DIFFS = {
      easy:   { rows: 8,  cols: 8,  mines: 10, label: "Easy (8√ó8)" },
      medium: { rows: 12, cols: 12, mines: 25, label: "Medium (12√ó12)" },
      hard:   { rows: 16, cols: 16, mines: 40, label: "Hard (16√ó16)" }
    };

    const inBounds = (r, c, rows, cols) => r >= 0 && r < rows && c >= 0 && c < cols;

    function neighbors(r, c, rows, cols){
      const out = [];
      for(let dr=-1; dr<=1; dr++){
        for(let dc=-1; dc<=1; dc++){
          if(dr === 0 && dc === 0) continue;
          const nr = r + dr, nc = c + dc;
          if(inBounds(nr, nc, rows, cols)) out.push([nr, nc]);
        }
      }
      return out;
    }

    let rows = 8, cols = 8, mines = 10;
    let board = [];
    let firstClick = true;
    let gameOver = false;
    let revealedCount = 0;
    let flaggedCount = 0;

    let timer = 0;
    let timerId = null;

    let difficulty = "easy";

    function setStatus(text){ $("status").textContent = text; }

    function stopTimer(){
      if(timerId){ clearInterval(timerId); timerId = null; }
    }

    function startTimer(){
      if(timerId) return;
      timerId = setInterval(() => {
        timer++;
        $("time").textContent = String(timer);
      }, 1000);
    }

    function resetTimer(){
      stopTimer();
      timer = 0;
      $("time").textContent = "0";
    }

    function updateMinesLeft(){
      const left = mines - flaggedCount;
      $("minesLeft").textContent = String(left);
    }

    function numberClass(n){
      return n >= 1 && n <= 8 ? `n${n}` : "";
    }

    function makeEmptyBoard(){
      board = [];
      revealedCount = 0;
      flaggedCount = 0;
      firstClick = true;
      gameOver = false;
      resetTimer();
      setStatus("Ready");

      const boardEl = $("board");
      boardEl.innerHTML = "";
      boardEl.style.gridTemplateColumns = `repeat(${cols}, 34px)`;

      for(let r=0; r<rows; r++){
        const row = [];
        for(let c=0; c<cols; c++){
          const cell = {
            r, c,
            mine: false,
            revealed: false,
            flagged: false,
            adj: 0,
            el: document.createElement("div")
          };

          cell.el.className = "cell";
          cell.el.dataset.r = r;
          cell.el.dataset.c = c;

          cell.el.addEventListener("click", (e) => {
            e.preventDefault();
            onReveal(cell);
          });

          cell.el.addEventListener("contextmenu", (e) => {
            e.preventDefault();
            onFlag(cell);
          });

          let pressTimer = null;
          cell.el.addEventListener("touchstart", () => {
            if(gameOver) return;
            pressTimer = setTimeout(() => {
              onFlag(cell);
              pressTimer = null;
            }, 450);
          }, { passive: true });

          cell.el.addEventListener("touchend", () => {
            if(pressTimer){
              clearTimeout(pressTimer);
              pressTimer = null;
            }
          });

          boardEl.appendChild(cell.el);
          row.push(cell);
        }
        board.push(row);
      }

      updateMinesLeft();
    }

    function placeMinesAvoiding(safeR, safeC){
      const safeSet = new Set();
      safeSet.add(`${safeR},${safeC}`);
      for(const [nr, nc] of neighbors(safeR, safeC, rows, cols)){
        safeSet.add(`${nr},${nc}`);
      }

      let placed = 0;
      while(placed < mines){
        const r = Math.floor(Math.random() * rows);
        const c = Math.floor(Math.random() * cols);
        const key = `${r},${c}`;
        if(safeSet.has(key)) continue;
        const cell = board[r][c];
        if(cell.mine) continue;
        cell.mine = true;
        placed++;
      }

      for(let r=0; r<rows; r++){
        for(let c=0; c<cols; c++){
          const cell = board[r][c];
          if(cell.mine){
            cell.adj = 0;
            continue;
          }
          let count = 0;
          for(const [nr, nc] of neighbors(r, c, rows, cols)){
            if(board[nr][nc].mine) count++;
          }
          cell.adj = count;
        }
      }
    }

    function revealCell(cell){
      if(cell.revealed || cell.flagged) return;
      cell.revealed = true;
      revealedCount++;

      cell.el.classList.add("revealed");
      cell.el.textContent = "";
      cell.el.classList.remove("clear");

      if(cell.mine){
        cell.el.classList.add("bomb");
        cell.el.textContent = "üí£";
        return;
      }

      if(cell.adj > 0){
        cell.el.textContent = String(cell.adj);
        cell.el.classList.add(numberClass(cell.adj));
      } else {
        cell.el.classList.add("clear");
        cell.el.textContent = "";
      }
    }

    function floodReveal(startCell){
      const q = [startCell];
      const seen = new Set([`${startCell.r},${startCell.c}`]);

      while(q.length){
        const cur = q.shift();
        revealCell(cur);

        if(cur.mine) continue;
        if(cur.adj !== 0) continue;

        for(const [nr, nc] of neighbors(cur.r, cur.c, rows, cols)){
          const nxt = board[nr][nc];
          const k = `${nr},${nc}`;
          if(seen.has(k)) continue;
          if(nxt.flagged) continue;
          seen.add(k);

          if(!nxt.revealed){
            if(nxt.adj === 0 && !nxt.mine){
              q.push(nxt);
            } else {
              revealCell(nxt);
            }
          }
        }
      }
    }

    function onReveal(cell){
      if(gameOver) return;
      if(cell.flagged) return;

      if(firstClick){
        firstClick = false;
        placeMinesAvoiding(cell.r, cell.c);
        startTimer();
        setStatus("Playing");
      }

      if(cell.revealed) return;

      if(cell.mine){
        revealCell(cell);
        endGame(false);
        return;
      }

      if(cell.adj === 0){
        floodReveal(cell);
      } else {
        revealCell(cell);
      }

      checkWin();
    }

    function onFlag(cell){
      if(gameOver) return;
      if(cell.revealed) return;

      cell.flagged = !cell.flagged;
      cell.el.classList.toggle("flagged", cell.flagged);
      cell.el.textContent = cell.flagged ? "üö©" : "";

      flaggedCount += cell.flagged ? 1 : -1;
      updateMinesLeft();
      checkWin();
    }

    function revealAllMines(){
      for(let r=0; r<rows; r++){
        for(let c=0; c<cols; c++){
          const cell = board[r][c];
          if(cell.mine && !cell.revealed){
            cell.revealed = true;
            cell.el.classList.add("revealed", "bomb");
            cell.el.textContent = "üí£";
          }
        }
      }
    }

    function checkWin(){
      if(gameOver) return;
      const safeCells = rows * cols - mines;
      if(revealedCount >= safeCells){
        endGame(true);
      }
    }

    function endGame(won){
      gameOver = true;
      stopTimer();

      if(won){
        setStatus("You win üéâ");
      } else {
        revealAllMines();
        setStatus("Game over üí•");
      }
    }

    function applyDifficulty(){
      const diff = DIFFS[difficulty] || DIFFS.easy;
      rows = diff.rows;
      cols = diff.cols;
      mines = diff.mines;
      $("ddLabel").textContent = diff.label;
    }

    function newGame(){
      applyDifficulty();
      makeEmptyBoard();
      updateMinesLeft();
    }

    // ----- Custom dropdown logic -----
    const dd = $("dd");
    const ddBtn = $("ddBtn");
    const ddMenu = $("ddMenu");

    ddBtn.addEventListener("click", (e) => {
      e.stopPropagation();
      dd.classList.toggle("open");
    });

    ddMenu.addEventListener("click", (e) => {
      const btn = e.target.closest(".ddItem");
      if(!btn) return;

      difficulty = btn.dataset.value;
      for(const item of ddMenu.querySelectorAll(".ddItem")){
        item.classList.toggle("active", item === btn);
      }
      dd.classList.remove("open");
      newGame();
    });

    document.addEventListener("click", () => dd.classList.remove("open"));
    document.addEventListener("keydown", (e) => {
      if(e.key === "Escape") dd.classList.remove("open");
    });

    $("newGame").addEventListener("click", newGame);

    $("year").textContent = new Date().getFullYear();
    newGame();
  </script>
</body>
</html>
